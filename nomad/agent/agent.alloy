logging {
	level  = "info"
	format = "logfmt"
}

livedebugging {
	enabled = true
}

otelcol.receiver.otlp "default" {
	http { }

	grpc { }

	output {
		metrics = [otelcol.processor.batch.default.input]
		logs    = [otelcol.processor.batch.default.input]
		traces  = [otelcol.processor.batch.default.input]
	}
}

otelcol.processor.batch "default" {
	output {
		metrics = [otelcol.exporter.loadbalancing.by_service.input]
		logs    = [otelcol.exporter.loadbalancing.by_service.input]
		traces  = [otelcol.exporter.loadbalancing.by_trace_id.input]
	}
}

local.file "gateways" {
	filename = "/local/gateways.yaml"
}

otelcol.exporter.loadbalancing "by_service" {
	routing_key = "service"
	resolver {
		static {
			hostnames = encoding.from_yaml(local.file.gateways.content)
		}
	}
	protocol {
		otlp {
			client {
				tls {
					insecure = true
				}
			}
		}
	}
}
otelcol.exporter.loadbalancing "by_trace_id" {
	routing_key = "traceID"
	resolver {
		static {
			hostnames = encoding.from_yaml(local.file.gateways.content)
		}
	}
	protocol {
		otlp {
			client {
				tls {
					insecure = true
				}
			}
		}
	}
}